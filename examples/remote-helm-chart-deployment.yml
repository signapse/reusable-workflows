name: Deploy Remote Helm Chart to EKS

# This example shows how to deploy a chart from a remote Helm repository
# (e.g., Bitnami, official Helm charts, etc.)

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to deploy to'
        required: true
        type: choice
        options:
          - dev
          - staging
          - production

permissions:
  id-token: write
  contents: read

jobs:
  # Example: Deploy NGINX from Bitnami Helm repository
  deploy-nginx:
    uses: signapse/reusable-workflows/.github/workflows/deploy-eks-helm.yml@main
    with:
      # AWS Configuration
      aws_region: "eu-west-2"
      iam_role_arn: "arn:aws:iam::887333319954:role/github-access"

      # EKS Configuration
      cluster_name: "${{ inputs.environment }}-cluster"
      namespace: "nginx"
      create_namespace: true

      # Helm Configuration
      release_name: "nginx-ingress"
      chart_path: "bitnami/nginx"  # Remote chart reference
      chart_version: "15.0.0"  # Specific chart version

      # Helm Repository
      helm_repo_name: "bitnami"
      helm_repo_url: "https://charts.bitnami.com/bitnami"

      # Values
      set_values: |
        service.type=LoadBalancer
        replicaCount=2

      # Deployment Options
      atomic: true
      wait: true
      timeout: "10m"

    permissions:
      id-token: write
      contents: read

  # Example: Deploy cert-manager from official repository
  deploy-cert-manager:
    uses: signapse/reusable-workflows/.github/workflows/deploy-eks-helm.yml@main
    with:
      # AWS Configuration
      aws_region: "eu-west-2"
      iam_role_arn: "arn:aws:iam::887333319954:role/github-access"

      # EKS Configuration
      cluster_name: "${{ inputs.environment }}-cluster"
      namespace: "cert-manager"
      create_namespace: true

      # Helm Configuration
      release_name: "cert-manager"
      chart_path: "jetstack/cert-manager"
      chart_version: "v1.13.0"

      # Helm Repository
      helm_repo_name: "jetstack"
      helm_repo_url: "https://charts.jetstack.io"

      # Values
      set_values: |
        installCRDs=true
        global.leaderElection.namespace=cert-manager

      # Deployment Options
      atomic: true
      wait: true
      timeout: "10m"

    permissions:
      id-token: write
      contents: read
